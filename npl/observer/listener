#ifndef LISTENER_HPP
#define LISTENER_HPP

#include <functional>

#include <observer/subject>

struct TListenerOnError { std::function<void (int)> cbk; };
struct TListenerOnAccept { std::function<void (void)> cbk; };
struct TListenerOnConnect { std::function<void (void)> cbk; };
struct TListenerOnDisconnect { std::function<void (void)> cbk; };
struct TListenerOnRead { std::function<void (const uint8_t *b, size_t n)> cbk; };
struct TListenerOnWrite { std::function<void (const uint8_t *b, size_t n)> cbk; };

namespace npl {

struct listener : public subject<uint8_t, uint8_t> {

    listener(){}
    virtual ~listener(){}

    virtual void onConnect(void) override {
        if (cbkConnect.cbk) {
            cbkConnect.cbk();
        }
    }

    virtual void onAccept() override {
        if (cbkAccept.cbk) {
            cbkAccept.cbk();
        }
    }

    virtual void onDisconnect(void) {
        if (cbkDisconnect.cbk) {
            cbkDisconnect.cbk();
        }
    }

    virtual void onError(int error) {
        if (cbkError.cbk) {
            cbkError.cbk(error);
        }
    }

    virtual void onRead(const uint8_t *b, size_t n) override {
        if (cbkRead.cbk) {
            cbkRead.cbk(b, n);
        }
    }

    virtual void onWrite(const uint8_t *b, size_t n) override {
        if (cbkWrite.cbk) {
            cbkWrite.cbk(b, n);
        }
    }

    template<typename T>
    void setCallback(T callback) {
        if constexpr(std::is_same<T, TListenerOnConnect>::value) {
            cbkConnect = callback;
        } else if constexpr(std::is_same<T, TListenerOnRead>::value) {
            cbkRead = callback;
        } else if constexpr(std::is_same<T, TListenerOnWrite>::value) {
            cbkWrite = callback;
        } else if constexpr(std::is_same<T, TListenerOnAccept>::value) {
            cbkAccept = callback;
        } else if constexpr(std::is_same<T, TListenerOnError>::value) {
            cbkError = callback;
        } else if constexpr(std::is_same<T, TListenerOnDisconnect>::value) {
            cbkDisconnect = callback;
        }
    }

    protected:

    TListenerOnRead cbkRead {nullptr};
    TListenerOnWrite cbkWrite {nullptr};
    TListenerOnError cbkError {nullptr};
    TListenerOnAccept cbkAccept {nullptr};
    TListenerOnConnect cbkConnect {nullptr};
    TListenerOnDisconnect cbkDisconnect {nullptr};
};

}

#endif